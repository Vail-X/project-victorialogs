api:
  address: 0.0.0.0:8686
  enabled: false
  playground: true
data_dir: /vector-data-dir
sinks:
  exporter:
    address: 0.0.0.0:9090
    inputs:
    - internal_metrics
    type: prometheus_exporter
  vlogs:
    api_version: v8
    compression: gzip
    endpoints:
    - http://vl-victoria-logs-cluster-vmauth.vm.svc.cluster.local:8427/insert/
    auth:
      user: ${VM_AUTH_USER}
      password: ${VM_AUTH_PASSWORD}
    healthcheck:
      enabled: false
    inputs:
    - parser
    mode: bulk
    request:
      headers:
        AccountID: "0"
        ProjectID: "0"
        VL-Msg-Field: message,msg,_msg,log.msg,log.message,log
        VL-Stream-Fields: stream,kubernetes.pod_name,kubernetes.container_name,kubernetes.pod_namespace
        VL-Time-Field: timestamp
    type: elasticsearch
    strategy: sync
sources:
  internal_metrics:
    type: internal_metrics
  k8s:
    type: kubernetes_logs
transforms:
  parser:
    inputs:
    - k8s
    source: |
      .log = parse_json(.message) ?? .message
      del(.message)
    type: remap